<?xml version="1.0" encoding="UTF-8"?>
<s:Skin xmlns:s="es.core" class="navigate">
    <s:Metadata>[HostComponent("es.components.Navigate")]</s:Metadata>
    <s:Script>
    <![CDATA[

        import es.interfaces.IContainer;

        override protected function initializing()
        {
            var hostComponent:Navigate = this.hostComponent;
            var dataSource:DataSource =  hostComponent.dataSource;
            var dataProfile:String =  hostComponent.dataProfile;
            var container:Skin = this.container;
            container.variable( dataProfile, hostComponent );
            var viewport:IContainer = hostComponent.viewport;
            var loadContent:Function = function(item:Object){
                 if( viewport && item.content instanceof Class )
                 {
                     var obj:Skin = Reflect.construct(null, item.content, [hostComponent] ) as Skin;
                     viewport.removeAllChild();
                     viewport.addChild( obj );
                 }
            };

            var current:* = hostComponent.current;
            container.variable( "current",  function(item:Object,key:*){
                var matched:Boolean = false;
                if( typeof current === "function" )
                {
                    matched = current(item,key) as Boolean;
                } else if(current==key){
                   matched=true;
                 }else if( item["link"] == current || item["label"] == current ){
                    matched=true;
                }else{
                   matched = new RegExp( current ).test( (String)item.link );
                }
                if( matched )loadContent(item);
                return matched;
            });

            dataSource.addEventListener(DataSourceEvent.SELECT, function (event:DataSourceEvent)
            {
                if ( !event.waiting )
                {
                    container.variable( dataProfile , event.data );
                    container.display();
                }
            });
            dataSource.select(1);
        }
    ]]>
    </s:Script>
    <style file="NavigateStyle.less" />
    <s:Skin id="@container" name="ul" class="nav nav-pills">
        <s:template>
            <:foreach name="datalist" value="item" key="link">
                <:if condition="current(item,forIndex)">
                   <li role="presentation" class="active"><a href="{item.link}">{item.label}</a></li>
                <:else />
                    <li role="presentation"><a href="{item.link}">{item.label}</a></li>
                </:if>
            </:foreach>
        </s:template>
    </s:Skin>
</s:Skin>